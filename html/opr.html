<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>考试答题</title>
    <link rel="stylesheet" href="../asset/css/bootstrap.css">
    <script src="../asset/js/jquery-2.2.0.min.js"></script>
    <script src="../asset/js/bootstrap.js"></script>
    <style>
        .page-container{
        }
    </style>
    <script>

    </script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="row menu-bar form-inline" style="margin-bottom: 15px">
            <div class="input-group">
                <div class="input-group-addon">输入网址</div>
                <input class="form-control col-md-2" name="url">
                <div class="input-group-btn">
                    <button class="btn btn-info" id="jump">确定</button>
                </div>
            </div>
            <div class="input-group pull-right">
                <div class="input-group-addon">点击获取信息</div>
                <div class="input-group-btn">
                    <button class="btn btn-success" id="get">确定</button>
                </div>
            </div>
        </div>
        <!--<div class="row">-->
            <div class="page-container" style="margin-left: -15px;">
                <iframe id="page" src="trade.html" seamless="seamless" width="900px">

                </iframe>
                <button class="btn btn-success" id="getPage">保存当前交易页面</button>
            </div>

            <div class="info-container col-md-6" style="margin-left: -30px;">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h3 class="panel-title">你的信息</h3>
                    </div>
                    <table class="table table-bordered" id="fieldInfo">
                        <thead>
                        <tr>
                            <th class="col-md-2">名称</th>
                            <th class="col-md-3">我的录入</th>
                            <th class="col-md-1">分值</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>


            </div>
        <!--</div>-->
    </div>
</div>

<script>
    $(function () {
        $("#page").on("load", function () {
            console.log("iframe loaded。。。");
            $("#get").trigger("click");
            var iframe = $("iframe")[0].contentDocument;
            var $iframe = $(iframe);

            $iframe.on("dblclick", "input, select", function () {
                console.log("double click");
            });
//            console.log($iframe.height)
            var height = $("iframe")[0].contentWindow.document.documentElement.scrollHeight;
            console.log("height:", height)

            //另外一种获取height的方法
            height = $("#page").contents().find("html").height();
            console.log("height:", height)
            var width = $("#page").contents().find("html").width();
            console.log("width: ", width);
            $("#page").width(width);

            $("#page").height(height + 20);
        })
        $("#get").on("click", function () {
            var iframe = $("iframe")[0].contentDocument;
            var $iframe = $(iframe);
            var buffer = "";
            $iframe.find("input, select").each(function (idx, obj) {
                var label = $(obj).prev().text();
//                console.log("label: ", label);
//                console.log("idx: ", idx);
//                console.log("obj: ", $(obj).val());
                buffer += "<tr>";
                buffer += "<td>" + label + "</td><td>" + $(obj).val() + "</td><td style='padding: 0px;'><input class='form-control' style='height:' type='text'></td>"
                buffer += "</tr>";
            });
            $("#fieldInfo").find("tbody").html(buffer);
        })

        $("#jump").on("click", function () {
            var url = $("[name='url']").val();
            console.log("url: ", url);
            $("#page").attr("src", url);
        })

        $("#getPage").on("click", function () {
            var html = $("#page").contents().find("html").html();
//            html = $("#page")[0].contentDocument;
//            console.log("html", html);
            html = "<html>" + html + "</html>";
            console.log("iframe", html);
            $.ajax({
                url: "savePage.do",
                type: 'post',
                data: {"info": html},
                success: function (data) {
                    var res = JSON.parse(data);
                    if(res.code == 0){
                        console.log("save successed");
                    }else{
                        console.log("save error");
                    }
                },
                error: function (data) {
                    console.log("save error");
                }
            })
        })
    })
</script>
</body>
</html>